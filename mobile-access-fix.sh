#!/bin/bash

# è§£æ±ºæ‰‹æ©Ÿç„¡æ³•è¨ªå•å•é¡Œçš„è…³æœ¬
echo "ğŸ“± è§£æ±ºæ‰‹æ©Ÿç„¡æ³•è¨ªå•å•é¡Œ"
echo "=================================="
echo ""

LOCAL_IP=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}')
echo "ğŸ“ æ‚¨çš„é›»è…¦ IP: $LOCAL_IP"
echo "ğŸ“± æ‰‹æ©Ÿæ‡‰è©²è¨ªå•: http://$LOCAL_IP:8080"
echo ""

echo "ğŸ” å•é¡Œè¨ºæ–·ï¼š"
echo "âœ… é›»è…¦å¯ä»¥è¨ªå• - æ‡‰ç”¨ç¨‹å¼é‹è¡Œæ­£å¸¸"
echo "âŒ æ‰‹æ©Ÿç„¡æ³•è¨ªå• - ç¶²è·¯é€£æ¥å•é¡Œ"
echo ""

echo "ğŸš€ è§£æ±ºæ–¹æ¡ˆï¼š"
echo ""

echo "æ–¹æ¡ˆ 1: æª¢æŸ¥æ‰‹æ©Ÿç¶²è·¯è¨­ç½®ï¼ˆæœ€å¸¸è¦‹ï¼‰"
echo "=================================="
echo "1. ç¢ºä¿æ‰‹æ©Ÿå’Œé›»è…¦é€£æ¥åŒä¸€ WiFi"
echo "2. æª¢æŸ¥æ‰‹æ©Ÿ WiFi è¨­ç½®ï¼š"
echo "   â€¢ æ‰“é–‹è¨­ç½® > WiFi"
echo "   â€¢ ç¢ºèªé€£æ¥çš„ WiFi åç¨±èˆ‡é›»è…¦ç›¸åŒ"
echo "3. å˜—è©¦é‡æ–°é€£æ¥ WiFi"
echo "4. é—œé–‰æ‰‹æ©Ÿ VPNï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰"
echo ""

echo "æ–¹æ¡ˆ 2: æª¢æŸ¥é˜²ç«ç‰†è¨­ç½®"
echo "=================================="
echo "åœ¨çµ‚ç«¯æ©Ÿä¸­é‹è¡Œä»¥ä¸‹å‘½ä»¤æª¢æŸ¥é˜²ç«ç‰†ï¼š"
echo "sudo pfctl -s rules | grep 8080"
echo ""
echo "å¦‚æœé˜²ç«ç‰†é˜»æ­¢äº†é€£æ¥ï¼Œå¯ä»¥æš«æ™‚é—œé–‰æ¸¬è©¦ï¼š"
echo "sudo pfctl -d"
echo "æ¸¬è©¦å®Œæˆå¾Œé‡æ–°å•Ÿç”¨ï¼š"
echo "sudo pfctl -e"
echo ""

echo "æ–¹æ¡ˆ 3: ä½¿ç”¨ä¸åŒç«¯å£"
echo "=================================="
echo "å‰µå»ºä½¿ç”¨ç«¯å£ 9000 çš„ä¼ºæœå™¨ï¼š"
echo "1. åœæ­¢ç•¶å‰ä¼ºæœå™¨ (Ctrl+C)"
echo "2. é‹è¡Œ: sed 's/8080/9000/g' server-8080.js > server-9000.js"
echo "3. é‹è¡Œ: node server-9000.js"
echo "4. åœ¨æ‰‹æ©Ÿä¸Šè¨ªå•: http://$LOCAL_IP:9000"
echo ""

echo "æ–¹æ¡ˆ 4: ä½¿ç”¨ ngrok éš§é“ï¼ˆæ¨è–¦ï¼‰"
echo "=================================="
echo "1. å®‰è£ ngrok: ./install-ngrok.sh"
echo "2. è¨»å†Š ngrok å¸³æˆ¶: https://ngrok.com/"
echo "3. ç²å–èªè­‰ä»¤ç‰Œä¸¦é‹è¡Œ: ngrok config add-authtoken YOUR_TOKEN"
echo "4. å•Ÿå‹•éš§é“: ngrok http 8080"
echo "5. ä½¿ç”¨ ngrok æä¾›çš„ HTTPS ç¶²å€"
echo ""

echo "æ–¹æ¡ˆ 5: ä½¿ç”¨æ‰‹æ©Ÿç†±é»æ¸¬è©¦"
echo "=================================="
echo "1. é–‹å•Ÿæ‰‹æ©Ÿç†±é»"
echo "2. è®“é›»è…¦é€£æ¥æ‰‹æ©Ÿç†±é»"
echo "3. ç²å–æ–°çš„ IP åœ°å€"
echo "4. åœ¨æ‰‹æ©Ÿä¸Šè¨ªå•æ–° IP"
echo ""

echo "ğŸ§ª æ¸¬è©¦æ­¥é©Ÿï¼š"
echo "=================================="
echo "1. åœ¨æ‰‹æ©Ÿç€è¦½å™¨ä¸­å˜—è©¦è¨ªå•ï¼š"
echo "   â€¢ http://$LOCAL_IP:8080"
echo "   â€¢ http://$LOCAL_IP:8080/simple-test.html"
echo "   â€¢ http://$LOCAL_IP:8080/debug.html"
echo ""
echo "2. æª¢æŸ¥æ‰‹æ©Ÿç¶²è·¯è¨­ç½®ï¼š"
echo "   â€¢ WiFi é€£æ¥ç‹€æ…‹"
echo "   â€¢ IP åœ°å€ç¯„åœ"
echo "   â€¢ DNS è¨­ç½®"
echo ""

echo "ğŸ“Š ç¶²è·¯è¨ºæ–·å‘½ä»¤ï¼š"
echo "=================================="
echo "# æª¢æŸ¥ç¶²è·¯ä»‹é¢"
echo "ifconfig | grep 'inet '"
echo ""
echo "# æª¢æŸ¥ç«¯å£ç›£è½"
echo "netstat -an | grep :8080"
echo ""
echo "# æ¸¬è©¦ç«¯å£é€£æ¥"
echo "nc -z $LOCAL_IP 8080"
echo ""

echo "ğŸ¯ å»ºè­°æ“ä½œé †åºï¼š"
echo "=================================="
echo "1. é¦–å…ˆæª¢æŸ¥æ‰‹æ©Ÿ WiFi é€£æ¥"
echo "2. å˜—è©¦é‡æ–°é€£æ¥ WiFi"
echo "3. æª¢æŸ¥é˜²ç«ç‰†è¨­ç½®"
echo "4. å˜—è©¦ä¸åŒç«¯å£"
echo "5. ä½¿ç”¨ ngrok éš§é“"
echo ""

echo "ğŸ“ å¦‚æœå•é¡Œä»ç„¶å­˜åœ¨ï¼š"
echo "=================================="
echo "â€¢ æª¢æŸ¥è·¯ç”±å™¨è¨­ç½®"
echo "â€¢ è¯ç¹«ç¶²è·¯ç®¡ç†å“¡ï¼ˆå¦‚æœåœ¨ä¼æ¥­ç¶²è·¯ä¸­ï¼‰"
echo "â€¢ è€ƒæ…®ä½¿ç”¨é›²ç«¯éƒ¨ç½²"
echo ""

# å‰µå»ºå¿«é€Ÿæ¸¬è©¦è…³æœ¬
cat > test-mobile-connection.sh << 'EOF'
#!/bin/bash
echo "ğŸ§ª æ¸¬è©¦æ‰‹æ©Ÿé€£æ¥..."
LOCAL_IP=$(ifconfig | grep "inet " | grep -v 127.0.0.1 | head -1 | awk '{print $2}')
echo "æ¸¬è©¦ç«¯å£ 8080..."
if nc -z $LOCAL_IP 8080 2>/dev/null; then
    echo "âœ… ç«¯å£ 8080 å¯ä»¥å¾å¤–éƒ¨è¨ªå•"
else
    echo "âŒ ç«¯å£ 8080 ç„¡æ³•å¾å¤–éƒ¨è¨ªå•"
    echo "å˜—è©¦ç«¯å£ 9000..."
    if nc -z $LOCAL_IP 9000 2>/dev/null; then
        echo "âœ… ç«¯å£ 9000 å¯ä»¥å¾å¤–éƒ¨è¨ªå•"
    else
        echo "âŒ ç«¯å£ 9000 ä¹Ÿç„¡æ³•å¾å¤–éƒ¨è¨ªå•"
        echo "å¯èƒ½æ˜¯é˜²ç«ç‰†å•é¡Œ"
    fi
fi
EOF

chmod +x test-mobile-connection.sh
echo "âœ… å·²å‰µå»ºæ¸¬è©¦è…³æœ¬: test-mobile-connection.sh"
echo "é‹è¡Œ: ./test-mobile-connection.sh"

